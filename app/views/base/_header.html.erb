
<nav class="main-header  navbar navbar-expand bg-color d-flex justify-content-between" id="collapse-sidebar" style="height:80px !important">
    <button class="border-0 bg-transparent" onclick="openNav()" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="true" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
	<!-- Left navbar links -->
	<ul class="navbar-nav align-items-center" id="hide-navbar-1">
		<!-- li class="nav-item">
			<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
		</li>
		<li class="nav-item d-none d-sm-inline-block">
			<%# <a href="index3.html" class="nav-link">Home</a> %>
		</li>Sidenav").style.width = "0";
		document.getElementById("body:not(.sidebar-mini-md):not(.sidebar-mini-xs):not(.layout-top-nav)
		<li class="nav-item d-none d-sm-inline-block">
			<%# <a href="#" class="nav-link">Contact</a> %>
		</li -->
		<li class="mx-2">
			<div class="d-flex">
				<div class="">
					<%= link_to notification_popup_notifications_path, remote: true do %>
						<i class="bi bi-bell-fill notification-icon" data-toggle="tooltip" title="Notification"></i>
					<% end %>
					<div id='notification-card'></div>
				</div>
				<div class="position-relative">
					<%  notification_count = Notification.where(recipient_id: current_user.id).where(read: false).count %>
					<% if notification_count > 0%>
						<div id="noti-count">
							<%= render "/base/notification_count", notification_count: notification_count%>
						</div>
					<%end%>
				</div>	
			</div>
		</li>
		
		<li>
			<div class="dropdown mx-2">
				<% if current_user.avatar.attached? %>
						<%= image_tag current_user.avatar, class: 'rounded-circle avatar_style dropbtn', onclick: "myFunction()" %>
				<% else %>
					<%= image_tag 'placeholder.jpg', class: 'rounded-circle avatar_style dropbtn', onclick: "myFunction()"%>
				<% end %>
				<div id="myDropdown" class="dropdown-content end-0">
					<div class="mt-2 text-bold text-center"> Hi <%= current_user.first_name.titleize %>! </div>
					<hr>
					<%= link_to " My Profile",user_path(current_user) %>
					<%= link_to "Edit Profile",edit_user_path(current_user) %>
					<%= link_to "Change Password", "#", "data-bs-toggle": "modal", "data-bs-target": "#change_password" %>
					<div id='password_form'></div>
					<%= link_to "Log Out",destroy_user_session_path, method: :delete, form_class: 'delete-alertbox',id: "logout" %>
						<%# <strong><i class="bi bi-power"></i></strong>
					<% end %> 
				</div>
			</div>
		</li>
	</ul>
	<!-- Right navbar links -->
	<!--ul class="navbar-nav ml-auto">
		<!-- Navbar Search >
		<li class="nav-item">
			<a class="nav-link" data-widget="navbar-search" href="#" role="button">
				<i class="fas fa-search"></i>
			</a>
			<div class="navbar-search-block">
				<form class="form-inline">
					<div class="input-group input-group-sm">
						<input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
						<div class="input-group-append">
							<button class="btn btn-navbar" type="submit">
								<i class="fas fa-search"></i>
							</button>
							<button class="btn btn-navbar" type="button" data-widget="navbar-search">
								<i class="fas fa-times"></i>
							</button>
						</div>
					</div>
				</form>
			</div>
		</li>

		<!-- Messages Dropdown Menu -->
		<!-- li class="nav-item dropdown">
			<a class="nav-link" data-toggle="dropdown" href="#"
				<i class="far fa-comments"></i>
				<span class="badge badge-danger navbar-badge">3</span>
			</a>
			<div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
				<a href="#" class="dropdown-item">
					
					<div class="media">
						<img src="dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
						<div class="media-body">
							<h3 class="dropdown-item-title">
								Brad Diesel
								<span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
							</h3>
							<p class="text-sm">Call me whenever you can...</p>
							<p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
						</div>
					</div>
				
				</a>
				<div class="dropdown-divider"></div>
				<a href="#" class="dropdown-item">
				
					<div class="media">
						<img src="dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
						<div class="media-body">
							<h3 class="dropdown-item-title">
								John Pierce
								<span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
							</h3>
							<p class="text-sm">I got your message bro</p>
							<p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
						</div>
					</div>
				
				</a>
				<div class="dropdown-divider"></div>
				<a href="#" class="dropdown-item">
					
					<div class="media">
						<img src="dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
						<div class="media-body">
							<h3 class="dropdown-item-title">
								Nora Silvester
								<span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
							</h3>
							<p class="text-sm">The subject goes here</p>
							<p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
						</div>
					</div>
				</a>
				<div class="dropdown-divider"></div>
				<a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
			</div>
		</li>
		<!-- Notifications Dropdown Menu >
		<li class="nav-item dropdown">
			<a class="nav-link" data-toggle="dropdown" href="#">
				<i class="far fa-bell"></i>
				<span class="badge badge-warning navbar-badge">15</span>
			</a>
			<div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
				<span class="dropdown-header">15 Notifications</span>
				<div class="dropdown-divider"></div>
				<a href="#" class="dropdown-item">
					<i class="fas fa-envelope mr-2"></i> 4 new messages
					<span class="float-right text-muted text-sm">3 mins</span>
				</a>
				<div class="dropdown-divider"></div>
				<a href="#" class="dropdown-item">
					<i class="fas fa-users mr-2"></i> 8 friend requests
					<span class="float-right text-muted text-sm">12 hours</span>
				</a>
				<div class="dropdown-divider"></div>
				<a href="#" class="dropdown-item">
					<i class="fas fa-file mr-2"></i> 3 new reports
					<span class="float-right text-muted text-sm">2 days</span>
				</a>
				<div class="dropdown-divider"></div>
				<a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
			</div>
		</li>
		<li class="nav-item">
			<a class="nav-link" data-widget="fullscreen" href="#" role="button">
				<i class="fas fa-expand-arrows-alt"></i>
			</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
				<i class="fas fa-th-large"></i>
			</a>
		</li>
	</ul-->
</nav>
<%= render partial: '/users/change_password'%>
<script>
	var count = 0;
	document.body.addEventListener('click', function(event) {
		if (event.target !== document.body) {
			const popup = document.querySelector('#notification-card');
			classes = event.target.classList;
			if ((count != 0) && !classes.contains("notification-icon") && classes.value != '') {
		
				$('#notification-card').addClass("d-none");
				count = count - 1;
			}
		}
	});

	document.getElementsByClassName('notification-icon')[0].addEventListener('click', function(event) {
		if (count != 0){
			$('#notification-card').addClass("d-none");
			count = 0;
		} else{
			$('#notification-card').removeClass("d-none");
			count = count + 1;
		}
	});
	function myFunction() {
		var x = document.getElementById("hide-navbar-1");
		if (x.style.display === "none") {
			x.style.display = "block";
		} else {
			x.style.display = "none";
		}
	}

	window.addEventListener(('turbo:load'), () => {
		document.addEventListener('submit', (event) => {
			if (event.target && event.target.className === 'delete-alertbox') {

			event.preventDefault()
			Swal.fire({
				title: 'Are you sure? You want to Logout',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				cancelButtonText: 'No',
				confirmButtonText: 'Yes'
			})
				.then((result) => {
				if (result.isConfirmed) {
					document.querySelector('.delete-alertbox').submit()
				}
				})
				.catch(event.preventDefault())
			}
		})
	});

	function myFunction() {
		document.getElementById("myDropdown").classList.toggle("show");
	}

	// Close the dropdown if the user clicks outside of it
	window.onclick = function(event) {
		if (!event.target.matches('.dropbtn')) {
			var dropdowns = document.getElementsByClassName("dropdown-content");
			var i;
			for (i = 0; i < dropdowns.length; i++) {
			var openDropdown = dropdowns[i];
			if (openDropdown.classList.contains('show')) {
				openDropdown.classList.remove('show');
			}
			}
		}
	}
</script>
<style>
	#notification-card{
		position: absolute;
		top: 50px;
		right: 150px;
		display: block;
		max-width: 300px;
		font-size: 0.875rem;
		word-wrap: break-word;
		background-color: #fff;
		background-clip: padding-box;
		border: 1px solid rgba(0, 0, 0, 0.2);
		border-radius: 0.3rem;
		box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.2);
	}
	.notification-icon{
		font-size: 22px;
	}
	.count-style{
		width: 20px;
		right: -7px;
		top: -6px;
		background-color: red;
		border-radius: 100%;
		height: 20px;
		text-align: center;
		font-size: 12px;
		color: white;
	}
	.avatar_style{
		height: 40px;
    	width: 40px;
	}
	.navbar-toggler-icon {
		background-image: var(--bs-navbar-toggler-icon-bg) !important;

	}
	#hide-navbar {
		width: 100%;
		padding: 50px 0;
		text-align: center;
		background-color: lightblue;
		margin-top: 20px;
	}
	 
	

	.dropbtn:hover, .dropbtn:focus {
		background-color: #2980B9;
	}

	.dropdown {
		position: relative;
		display: inline-block;
	}

	.dropdown-content {
		display: none;
		position: absolute;
		background-color: #f1f1f1;
		min-width: 210px;
		overflow: auto;
		box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
		z-index: 1;
	}

	.dropdown-content a {
		color: black;
		padding: 10px 16px;
		text-decoration: none;
		display: block;
		
	}
	.dropdown-content strong {
		margin-top:10px
	}
	.dropdown-content hr{
		margin-bottom:0px !important;
		margin-top:10px !important
	}

	.dropdown a:hover {background-color: #ddd;}

	.show {display: block;}

</style>

  