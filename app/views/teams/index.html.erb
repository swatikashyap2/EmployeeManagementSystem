<div class="content-header">
	<div class="container-fluid">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div>
						<ol class="breadcrumb float-sm-right">
							<li class="breadcrumb-item"><%= link_to "Dashboard", home_index_path %></li>
							<li class="breadcrumb-item active">Teames</li>
						</ol>
					</div>
					<div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="card overflow-auto">
	<div class="card-body">
		<table class='table'>
			<div>
				<thead> 
					<th>Image</th>
					<th>First Name</th>
					<th>Last Name</th>
					<th>Email</th>
					<th>Designation</th>
					<th>Phone No</th>
					<th>Employee Code</th>
					<th>Dob</th>
					<th>Role</th>
					<th>Gender</th>
					<th>Zip Code</th>
					<th>Address</th>
				</thead>
				<tbody>
						<% if @users.present?%>
							<% @users.each do|user|%>
								<tr>
									<td>
										<% if user.avatar.attached? %>
												<%= image_tag user.avatar, class: 'rounded-circle avatar_style' %>
										<% else %>
											<%= image_tag 'placeholder.jpg', class: 'rounded-circle avatar_style' %>
										<% end %>
									</td>
									<td>
										<%= user.first_name.present? ?  user.first_name.titleize : "N/A"%>
									</td>
									<td>
										<%= user.last_name.present? ?  user.last_name.titleize : "N/A"%>
									</td>
									<td>
										<%= user.email.present? ?  user.email : "N/A"%>
									</td>
									<td>
										<%= user.designation.present? ?  user.designation.titleize : "N/A"%>
									</td>
									<td>
										<%= user.phone.present? ?  user.phone : "N/A"%>
									</td>
									<td>
										<%= user.employee_code.present? ?  user.employee_code : "N/A"%>
									</td>
									<td>
										<%= user.dob.present? ? user.dob.strftime("%B %d, %Y") : 'N/A' %>			
									</td>
									<td>
										<%= user.role.name.present? ?  user.role.name.titleize : "N/A"%>
									</td>
									<td>
										<%= user.gender.present? ?  user.gender.titleize : "N/A"%>
									</td>
									<td>
										<%= user.zip_code.present? ?  user.zip_code : "N/A"%>
									</td>
									<td>
										<%= user.address.present? ?  user.address : "N/A"%>
									</td>
									
								</tr>
							<%end%>
						<% else %>
							<tr>
								<td colspan="12" class="text-center border-0">
									<h2 class="mt-3">Record Not Found</h2>
								</td>
							</tr>
                    <% end %>
				</tbody>
			</div>
		</table>
	</div>
	<div class="p-4">
		<% if is_admin? || is_manager?%>
			<%= will_paginate @users%>
		<%end%>
	</div>
</div>
<div id="ppc_manager"></div>


<script>
	window.addEventListener(('turbo:load'), () => {
		document.addEventListener('submit', (event) => {
			if (event.target && event.target.className === 'delete-alertbox') {
			event.preventDefault()
			Swal.fire({
				title: 'Are you sure? You want to Delete this Employee',
				text: "You won't be able to revert this!",
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				cancelButtonText: 'No',
				confirmButtonText: 'Yes'
			})
				.then((result) => {
				if (result.isConfirmed) {
					document.querySelector('.delete-alertbox').submit()
				}
				})
				.catch(event.preventDefault())
			}
		})
	});
	document.addEventListener("turbo:load", function() {
		var user_password = [];
		$.ajax({
			type: "GET",
			url: "/users/get_password",
			dataType: "json",
			data: { key1: true },
			success: function(response) {
				emails = response.emails; 
			},
			error: function(jqXHR, textStatus, errorThrown) {
				console.error("Error fetching emails:", errorThrown);
			}
		});
	});
</script>

