<table class='table'>
    <div>
        <thead> 
            <th>Image</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Designation</th>
            <th>Phone No</th>
            <th>Employee Code</th>
            <th>Dob</th>
            <th>Role</th>
            <th>Gender</th>
            <th>Zip Code</th>
            <th>Address</th>
            <% if is_admin? || is_manager? %>
                <th>Actions</th>
            <%end%>
        </thead>
        <tbody>
            <% if @users.present?%>
                <% @users.each do|user|%>
                    <tr>
                        <td>
                            <% if user.avatar.attached? %>
                                <%= image_tag user.avatar, class: 'rounded-circle avatar_style' %>
                            <% else %>
                                <%= image_tag 'placeholder.jpg', class: 'rounded-circle avatar_style' %>
                            <% end %>
                        </td>
                        <td>
                            <%= user.first_name.present? ?  user.first_name.titleize : "N/A"%>
                        </td>
                        <td>
                            <%= user.last_name.present? ?  user.last_name.titleize : "N/A"%>
                        </td>
                        <td>
                            <%= user.email.present? ?  user.email : "N/A"%>
                        </td>
                        <td>
                            <%= user.designation.present? ?  user.designation.titleize : "N/A"%>
                        </td>
                        <td>
                            <%= user.phone.present? ?  user.phone : "N/A"%>
                        </td>
                        <td>
                            <%= user.employee_code.present? ?  user.employee_code : "N/A"%>
                        </td>
                        <td>
                            <%= user.dob.present? ? user.dob.strftime("%B %d, %Y") : 'N/A' %>			
                        </td>
                        <td>
                            <%= user.role.name.present? ?  user.role.name.titleize : "N/A"%>
                        </td>
                        <td>
                            <%= user.gender.present? ?  user.gender.titleize : "N/A"%>
                        </td>
                        <td>
                            <%= user.zip_code.present? ?  user.zip_code : "N/A"%>
                        </td>
                        <td>
                            <div class="d-none address">
                                <%= user.address %>
                            </div>
                            <i class="bi bi-info-circle text-primary" onclick="showAddress(this)" data-bs-toggle="tooltip" data-bs-placement="top" title="View Address"></i>
                        </td>
                        <td class="p-2">
                            <div class="d-flex">
                                <% if is_admin? || is_manager? %>
                                    <div>
                                        <%= link_to edit_user_path(user), method: :get, class: "mx-2", 'data-toggle': 'tooltip', 'data-placement':'top', title: 'Edit User'  do%> 
                                            <i class="bi bi-pencil-square"></i>
                                        <%end%>
                                    </div>
                                    <% if user.password_send !=  true%>
                                        <div>
                                            <%= link_to send_password_user_path(user), method: :get,id: "send-password-link",class: "mx-2 send-password-link",'data-toggle': 'tooltip', 'data-placement':'top', title: 'Send Password' do %>
                                                <i class="bi bi-arrow-right-circle"></i>
                                            <%end%>
                                        </div>	
                                    <%end%>
                                <%end%>
                                <%if is_admin?%>	
                                    <%= link_to edit_user_leave_type_path(user), {remote: true, "data-bs-toggle": "modal", "data-bs-target": "#ppc_manager_modal" } do%>
                                    <span data-toggle='tooltip', data-placement='top', title= 'Edit User Leaves'>
                                        <i class="bi bi-file-earmark-diff"></i>
                                    </span>
                                    <% end %>

                                    <% if current_user != user %>
                                        <%= button_to user_path(user), method: :delete, class:'border-0 bg-transparent text-danger mx-2', form_class: 'delete-alertbox', 'data-toggle': 'tooltip', 'data-placement': 'top', title: 'Delete User' do %> 
                                            <i class="bi bi-trash3-fill"></i>
                                        <% end %>      
                                    <%end%>	
                                <%end%>
                                <%if is_admin? || is_manager? %>
                                    <%= link_to user_path(user),class: "mx-2", 'data-toggle': 'tooltip', 'data-placement':'top', title: 'View User'  do%>
                                       <i class="bi bi-eye-fill"></i>
                                    <% end %>
                                <%end%>
                            </div>
                        </td>
                    </tr>
                <%end%>
            <% else %>
                <tr>
                    <td colspan="12" class="text-center border-0">
                        <h2 class="mt-3">Record Not Found</h2>
                    </td>
                </tr>
            <% end %>
        </tbody>
    </div>
</table>
<div class="p-4">
    <% if is_admin? || is_manager?%>
        <%= will_paginate @users%>
    <%end%>
</div>
<script>
	window.addEventListener(('turbo:load'), () => {
		document.addEventListener('submit', (event) => {
			if (event.target && event.target.className === 'delete-alertbox') {
			event.preventDefault()
			Swal.fire({
				title: 'Are you sure? You want to Delete this Employee',
				text: "You won't be able to revert this!",
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				cancelButtonText: 'No',
				confirmButtonText: 'Yes'
			})
			.then((result) => {
				if (result.isConfirmed) {
					document.querySelector('.delete-alertbox').submit()
				}
				})
				.catch(event.preventDefault())
			}
		})
	});
	// document.addEventListener("turbo:load", function() {
	// 	var user_password = [];
	// 	$.ajax({
	// 		type: "GET",
	// 		url: "/users/get_password",
	// 		dataType: "json",
	// 		data: { key1: true },
	// 		success: function(response) {
	// 			emails = response.emails; 
	// 		},
	// 		error: function(jqXHR, textStatus, errorThrown) {
	// 			console.error("Error fetching emails:", errorThrown);
	// 		}
	// 	});
	// });

	function showAddress(element) {
		var tr = $(element).closest('tr');
		var address = tr.find('.address').text();
		Swal.fire({
		title: 'Address',
		text: address,
		confirmButtonText: 'OK'
		});
	}
		
</script>